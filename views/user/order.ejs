<style>
  .hide {
    display: none;
    position: absolute;
    top: 76px;
    left: 94px;
  }

  .addr:hover+.hide {
    display: block;
  }
</style>
<section>

  <div class="page-header text-center" style="background-image: url('/images/page-header-bg.jpg')">
    <div class="container">
      <h1 class="page-title">Orders<span>your orders</span></h1>
    </div>
  </div>

  <div class="page-content">
    <div class="container">

      <div class="container ">

        <%  const dataToReadable=(date)=>{

                    const date_ = new Date(date);
                    let month = ['Jan','Feb','March','April','May','June','July','Aug','Sept','Nov','Dec']
                    let dd = date_.getDate();
                    let mm = date_.getMonth()-1;
                    let monthText = month[mm]
                    let yyyy = date_.getFullYear();
                                    
                    return `${isNaN(dd)?'00':dd}-${monthText}-${isNaN(yyyy)?'0000':yyyy}`;
                    }; %>

        <% const status=(status)=>{
                        if(status==true){
                            return `${'Order Placed'}`
                        }else{
                            return `${'Order Cancelled'}`
                        }
                    } %>
        <% orders?.forEach((element,index) => { %>
        <div class="row my-3" style="width:100%; height:300px; border: 0.8px solid rgb(106, 103, 103); background-color: rgb(255, 255, 255); border-radius: 10px;">
          <div class="col-12">
            <div class="col-md-6" style="float: left; ">
              <div class="d-flex mt-3 ">
                <a href="/product/<%=element.orders.productDetails?._id %>">
                  <img src="/productImages/<%=element.orders.productDetails?._id%>0.jpg" alt="Product image" style="max-width: 250px; max-height:250px;">
                </a>
                <div class="mx-5 mt-3 ">
                  <a href="#" style="font-size: x-large; font-weight: 600; color: black !important"><%=element.orders.productDetails.productName?.slice(0,30)+"..." %></a>
                  <div class="w-100 rounded ">
                    <div class="price-col" style="font-weight: 600; font-size: large;"><span class="" style="color: rgb(255, 145, 0);">Rs <%=element?.orders?.productDetails?.productPrice%></span> x <%=element?.orders?.productDetails?.quantity%> pcs</div>
                    <% if(element?.orders?.productDetails?.status){ %>
                    <div class="price-col mt-2">
                      <button class="btn btn-block btn-outline-primary-2" style="border-radius: 20px; width: 100px;" onclick="cancelOrder('<%=element?.orders?.productDetails?._id%>','<%=element?.orders?._id%>')">Cancel Order</button>
                    </div>
                    <%}%>
                                    </div>
                             </div>
                            </div>
                     </div>
                     <div class="col-md-1" style="float: left;">
                        <div class="mt-2" style="width: 0.5px; height:250px; background-color:rgb(155, 155, 155); ">
                                
                            </div>
                        </div>
                        <div class="col-md-5" style="float: left;">
                            <div class=" d-flex flex-column " style="margin-top: 50px; margin-left: 10px;">

                                
                                <div class="price-col" style="font-weight: 600;font-size: large;"><span style=" color:black">Ordered on:</span><span class="mx-4"><%= dataToReadable(element.orders.createdAt) %></span>
                  </div>
                  <% if(element?.orders?.productDetails.status){ %>
                  <div class="price-col mt-2" style="font-weight: 600; font-size: large;"><span style="font-size: large; color:black">Delivery Status:</span><span class="mx-4" style="color:#c81e01;"><%= element.orders.productDetails.delivery%></span></div>
                  <%}else{ %>
                  <div class="price-col mt-2" style="font-weight: 600; font-size: large; color: rgb(155, 155, 155);"><span style="font-size: large; color:black">Delivery Status:</span><span class="mx-4">Cancelled</span></div>
                  <% } %>
                  <div class="price-col mt-2" style="font-weight: 600; font-size: large;"><span class="in-stock" style="color: <%= element.orders.productDetails.status?'rgb(165,199,108)':'rgb(200,30,0)' %>"><span style="font-size: large; color:black">Order Status: </span><%=status(element.orders.productDetails.status)%></span></div>

                  <div class="addr price-col mt-2" style="font-weight: 600; font-size: large;"><span style="font-size: large; color:black">Shipping Address:</span><span class="mx-4" style="color:rgb(13, 115, 131)"><%= element.orders.fName%><i class="ri-arrow-right-s-fill"></i></span></div>
                  <div class="hide">

                    <div class="d-flex border mt-2 p-3" style="overflow: hidden ;margin-left: 50px; max-height:150px; max-width: 700px; background-color: white; z-index: 100;">
                      <span style="color:black;">
                        <p style="font-weight: 600; color: black;"><%= element.orders.fName%>,</p>
                        <%=element.orders.shippingAddress.address %>, <%=element.orders.shippingAddress.postcode%>, <%=element.orders.shippingAddress.country%>
                      </span>
                    </div>

                  </div>
                </div>
              </div>
            </div>
          </div>
          <% }); %>

          <%if(orders.length == 0){ %>
          <div class="row">
            <div class="col-lg-12">
              <h1 class=" mt-4 mx-1 mb-3 ">No Orders</h1>
            </div>
          </div>
          <%} %>

        </div>

        <div class="wishlist-share">
          <div class="social-icons social-icons-sm mb-2">
            <label class="social-label">Share on:</label>
            <a href="#" class="social-icon" title="Facebook" target="_blank"><i class="icon-facebook-f"></i></a>
            <a href="#" class="social-icon" title="Twitter" target="_blank"><i class="icon-twitter"></i></a>
            <a href="#" class="social-icon" title="Instagram" target="_blank"><i class="icon-instagram"></i></a>
            <a href="#" class="social-icon" title="Youtube" target="_blank"><i class="icon-youtube"></i></a>
            <a href="#" class="social-icon" title="Pinterest" target="_blank"><i class="icon-pinterest"></i></a>
          </div>
        </div>
      </div>
    </div>
</section>

<script>
  function cancelOrder(proId, orderId) {
    console.log(proId, orderId);
    $.ajax({
      url: '/orders',
      data: {
        proId: proId,
        orderId: orderId
      },
      method: 'post',
      beforeSend: () => {
        return confirm('Are you sure want to cancel this order?')
      },
      success: (response) => {
        if (response.status) {
          location.reload()
        }
      }
    })
  }
</script>